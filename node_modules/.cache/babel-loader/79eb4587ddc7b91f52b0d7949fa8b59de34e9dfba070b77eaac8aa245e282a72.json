{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nvar _class;\nimport { AUTH_TOKEN_KEY } from '../constants';\nimport { validateJwt } from '../utils';\nimport { LocalStorageBackend } from '../utils/storage';\nconst AUTH_EXPIRY_BUFFER = 1 * 60 * -1; // 1 mins in seconds\n\nclass AuthToken {\n  constructor() {}\n  static save(token) {\n    Promise.all([this._storageBackend.setItem(AUTH_TOKEN_KEY, JSON.stringify(token))]).then(() => {\n      this.token = token;\n    });\n  }\n  static async get() {\n    let token = this.token;\n    if (!token) {\n      const tokenFromStorage = JSON.parse(await this._storageBackend.getItem(AUTH_TOKEN_KEY));\n      if (tokenFromStorage) {\n        token = tokenFromStorage;\n        this.token = token;\n      }\n    }\n    return token;\n  }\n  static async isValid() {\n    let buffer = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : AUTH_EXPIRY_BUFFER;\n    try {\n      return validateJwt(this.token.access_token, buffer);\n    } catch (e) {}\n    return false;\n  }\n  static async isValidRefreshToken() {\n    try {\n      return validateJwt(this.token.refresh_token);\n    } catch (e) {}\n    return false;\n  }\n}\n_class = AuthToken;\n_defineProperty(AuthToken, \"_storageBackend\", null);\n_defineProperty(AuthToken, \"token\", null);\n_defineProperty(AuthToken, \"initInstanceStorage\", () => {\n  _class._storageBackend = new LocalStorageBackend();\n});\nexport { AuthToken };","map":{"version":3,"names":["AUTH_TOKEN_KEY","validateJwt","LocalStorageBackend","AUTH_EXPIRY_BUFFER","AuthToken","constructor","save","token","Promise","all","_storageBackend","setItem","JSON","stringify","then","get","tokenFromStorage","parse","getItem","isValid","buffer","arguments","length","undefined","access_token","e","isValidRefreshToken","refresh_token","_class","_defineProperty"],"sources":["/Users/phuocnd/phuocnd/works/mirai/miraiidjs/src/auth-client/controllers/auth-token.ts"],"sourcesContent":["import { AUTH_TOKEN_KEY, auth } from '../constants';\nimport { validateJwt } from '../utils';\nimport { LocalStorageBackend, StorageBackend } from '../utils/storage';\n\nconst AUTH_EXPIRY_BUFFER = 1 * 60 * -1; // 1 mins in seconds\n\nclass AuthToken {\n    static _storageBackend: StorageBackend = null;\n    private static token: auth.TMiraiAccessToken | undefined = null;\n\n    constructor() {}\n\n    static initInstanceStorage = () => {\n        this._storageBackend = new LocalStorageBackend();\n    };\n\n    static save(token: auth.TMiraiAccessToken) {\n        Promise.all([this._storageBackend.setItem(AUTH_TOKEN_KEY, JSON.stringify(token))]).then(() => {\n            this.token = token;\n        });\n    }\n\n    static async get(): Promise<auth.TMiraiAccessToken> {\n        let token = this.token;\n\n        if (!token) {\n            const tokenFromStorage = JSON.parse(\n                await this._storageBackend.getItem(AUTH_TOKEN_KEY)\n            ) as auth.TMiraiAccessToken;\n\n            if (tokenFromStorage) {\n                token = tokenFromStorage;\n                this.token = token;\n            }\n        }\n\n        return token;\n    }\n\n    static async isValid(buffer: number = AUTH_EXPIRY_BUFFER): Promise<boolean> {\n        try {\n            return validateJwt(this.token.access_token, buffer);\n        } catch (e) {}\n        return false;\n    }\n\n    static async isValidRefreshToken(): Promise<boolean> {\n        try {\n            return validateJwt(this.token.refresh_token);\n        } catch (e) {}\n        return false;\n    }\n}\n\nexport { AuthToken };\n"],"mappings":";;AAAA,SAASA,cAAc,QAAc,cAAc;AACnD,SAASC,WAAW,QAAQ,UAAU;AACtC,SAASC,mBAAmB,QAAwB,kBAAkB;AAEtE,MAAMC,kBAAkB,GAAG,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC;;AAExC,MAAMC,SAAS,CAAC;EAIZC,WAAWA,CAAA,EAAG,CAAC;EAMf,OAAOC,IAAIA,CAACC,KAA6B,EAAE;IACvCC,OAAO,CAACC,GAAG,CAAC,CAAC,IAAI,CAACC,eAAe,CAACC,OAAO,CAACX,cAAc,EAAEY,IAAI,CAACC,SAAS,CAACN,KAAK,CAAC,CAAC,CAAC,CAAC,CAACO,IAAI,CAAC,MAAM;MAC1F,IAAI,CAACP,KAAK,GAAGA,KAAK;IACtB,CAAC,CAAC;EACN;EAEA,aAAaQ,GAAGA,CAAA,EAAoC;IAChD,IAAIR,KAAK,GAAG,IAAI,CAACA,KAAK;IAEtB,IAAI,CAACA,KAAK,EAAE;MACR,MAAMS,gBAAgB,GAAGJ,IAAI,CAACK,KAAK,CAC/B,MAAM,IAAI,CAACP,eAAe,CAACQ,OAAO,CAAClB,cAAc,CACrD,CAA2B;MAE3B,IAAIgB,gBAAgB,EAAE;QAClBT,KAAK,GAAGS,gBAAgB;QACxB,IAAI,CAACT,KAAK,GAAGA,KAAK;MACtB;IACJ;IAEA,OAAOA,KAAK;EAChB;EAEA,aAAaY,OAAOA,CAAA,EAAwD;IAAA,IAAvDC,MAAc,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAGlB,kBAAkB;IACpD,IAAI;MACA,OAAOF,WAAW,CAAC,IAAI,CAACM,KAAK,CAACiB,YAAY,EAAEJ,MAAM,CAAC;IACvD,CAAC,CAAC,OAAOK,CAAC,EAAE,CAAC;IACb,OAAO,KAAK;EAChB;EAEA,aAAaC,mBAAmBA,CAAA,EAAqB;IACjD,IAAI;MACA,OAAOzB,WAAW,CAAC,IAAI,CAACM,KAAK,CAACoB,aAAa,CAAC;IAChD,CAAC,CAAC,OAAOF,CAAC,EAAE,CAAC;IACb,OAAO,KAAK;EAChB;AACJ;AAACG,MAAA,GA9CKxB,SAAS;AAAAyB,eAAA,CAATzB,SAAS,qBAC8B,IAAI;AAAAyB,eAAA,CAD3CzB,SAAS,WAEgD,IAAI;AAAAyB,eAAA,CAF7DzB,SAAS,yBAMkB,MAAM;EAC/BwB,MAAA,CAAKlB,eAAe,GAAG,IAAIR,mBAAmB,CAAC,CAAC;AACpD,CAAC;AAwCL,SAASE,SAAS"},"metadata":{},"sourceType":"module","externalDependencies":[]}