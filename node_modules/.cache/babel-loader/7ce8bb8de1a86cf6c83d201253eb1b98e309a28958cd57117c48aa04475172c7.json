{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n/* eslint-disable @typescript-eslint/no-unused-vars */\nimport { connect } from 'socket.io-client';\nimport { WebSocketConnection } from './connection-wrapper';\nimport { BaseWebSocketService } from './ws-base';\nexport class SignerWebSocketService extends BaseWebSocketService {\n  constructor(opts) {\n    super(opts);\n    _defineProperty(this, \"url\", void 0);\n    _defineProperty(this, \"accessToken\", void 0);\n    _defineProperty(this, \"socket\", void 0);\n    _defineProperty(this, \"disconnect\", async () => {\n      return this.socket.disconnect();\n    });\n    _defineProperty(this, \"establish\", async acknowledgement => {\n      const headers = await this.getHeaders(this.accessToken);\n\n      // const socket = io(this.url, {\n      // \tautoConnect: false,\n      // \treconnection: true,\n      // \ttransportOptions: {\n      // \t\twebsocket: {\n      // \t\t\textraHeaders: headers,\n      // \t\t},\n      // \t},\n      // \textraHeaders: headers,\n      // \ttransports: ['websocket'],\n      // \tauth: headers,\n      // });\n\n      const socket = connect(this.url, {\n        autoConnect: false,\n        reconnection: false,\n        // transportOptions: {\n        //   websocket: {\n        //     extraHeaders: {\n        //       authorization:\n        //         \"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJhMGJhYzYwNC0wZmE0LTQ0N2EtYTNkZS00ZGVmZjAyMDA4YzQiLCJqdGkiOiIyYzQyZmQzZC04M2FkLTQzZTEtOWE4NS00NjRlZjRlNzhkYjkiLCJleHAiOjE2OTI5NDYxNTcsInN1YiI6ImJmYjRmZmY2LWUzMTQtNDI2OS1iYTAyLWRmYzU5MTk1MzRjZiIsInNjb3BlcyI6WyJvcGVuaWQiLCJlbWFpbCIsIm9mZmxpbmVfYWNjZXNzIiwicHJvZmlsZSJdLCJlbWFpbCI6ImR1Y3BodW9jLnQ5QGdtYWlsLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJuYW1lIjoiUGjGsOG7m2MgTmd1eeG7hW4gxJDhu6ljIiwiZ2l2ZW5fbmFtZSI6IlBoxrDhu5tjIiwiZmFtaWx5X25hbWUiOiJOZ3V54buFbiDEkOG7qWMiLCJpc3MiOiJodHRwczovL2lkLWRldi12Mi5taXJhaWxhYnMuY28iLCJhenAiOiJhMGJhYzYwNC0wZmE0LTQ0N2EtYTNkZS00ZGVmZjAyMDA4YzQiLCJpYXQiOjE2OTI4NTk3NTd9.CoeBHfbUk3hC9PGz4c51dOojXptKR78OsfcSEoQY6PVulcEE8tjxDEOqMtlDU6-eyKDTg9qiQRNxtXf5iHVFeNbZ9E32JdyFsDiwSGjaD1HRpzq7Xm8QkA9SPFO0QQP6BSNgHIgg4fYNrii0t-0r7wojg_sfgjDDyCX_vmZY4TYCIjr9TS9vrELupcW716Y_seiGr6WQfy6HyfTbVSGRb4yviNcOMjDeORht2JuJajLsrMSQsYGXcx_V04uXrcC1SY0xi7LnsVQfQSWyKTf6xoTix6cm3gnzbyZYZJrPqDJtDu2FRxBLNLR53NNc8v3UjaJREjdcNgvvLGarw_HY61Azsqh5LaE_KZuZeBxtBBVjlN209N7hRNPrKv_RbnTnIBvoGjv0zjlN4r42_DPGWojnaqkuConrY2W7daQHHPMdf7XnnlfPL7g3osyO_8TMFLVjdxBEr1cPe6YZERvMMiVbDYg3fEps4dsjabJE4CkaTDt5j1CI8EjiMjhPnrbeq2htd4RsqjDI7enK0l4HAvy-kZJcPNXY6JRgq2R0C_Qh1gSSu8nd_RuutKDmEQ-r_uf6j5KsF-jTRs8qRgPEeO3DLgtDjSl2TLTWXEA8kaSy6Gj41rCyHO5pwPCdK2ySqe1oKIltCwLDAk4MfA83-yPVmeS3B6LZl79yCvpTczE\",\n        //     },\n        //   },\n        // },\n        // extraHeaders: {\n        //   authorization:\n        //     \"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJhMGJhYzYwNC0wZmE0LTQ0N2EtYTNkZS00ZGVmZjAyMDA4YzQiLCJqdGkiOiIyYzQyZmQzZC04M2FkLTQzZTEtOWE4NS00NjRlZjRlNzhkYjkiLCJleHAiOjE2OTI5NDYxNTcsInN1YiI6ImJmYjRmZmY2LWUzMTQtNDI2OS1iYTAyLWRmYzU5MTk1MzRjZiIsInNjb3BlcyI6WyJvcGVuaWQiLCJlbWFpbCIsIm9mZmxpbmVfYWNjZXNzIiwicHJvZmlsZSJdLCJlbWFpbCI6ImR1Y3BodW9jLnQ5QGdtYWlsLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJuYW1lIjoiUGjGsOG7m2MgTmd1eeG7hW4gxJDhu6ljIiwiZ2l2ZW5fbmFtZSI6IlBoxrDhu5tjIiwiZmFtaWx5X25hbWUiOiJOZ3V54buFbiDEkOG7qWMiLCJpc3MiOiJodHRwczovL2lkLWRldi12Mi5taXJhaWxhYnMuY28iLCJhenAiOiJhMGJhYzYwNC0wZmE0LTQ0N2EtYTNkZS00ZGVmZjAyMDA4YzQiLCJpYXQiOjE2OTI4NTk3NTd9.CoeBHfbUk3hC9PGz4c51dOojXptKR78OsfcSEoQY6PVulcEE8tjxDEOqMtlDU6-eyKDTg9qiQRNxtXf5iHVFeNbZ9E32JdyFsDiwSGjaD1HRpzq7Xm8QkA9SPFO0QQP6BSNgHIgg4fYNrii0t-0r7wojg_sfgjDDyCX_vmZY4TYCIjr9TS9vrELupcW716Y_seiGr6WQfy6HyfTbVSGRb4yviNcOMjDeORht2JuJajLsrMSQsYGXcx_V04uXrcC1SY0xi7LnsVQfQSWyKTf6xoTix6cm3gnzbyZYZJrPqDJtDu2FRxBLNLR53NNc8v3UjaJREjdcNgvvLGarw_HY61Azsqh5LaE_KZuZeBxtBBVjlN209N7hRNPrKv_RbnTnIBvoGjv0zjlN4r42_DPGWojnaqkuConrY2W7daQHHPMdf7XnnlfPL7g3osyO_8TMFLVjdxBEr1cPe6YZERvMMiVbDYg3fEps4dsjabJE4CkaTDt5j1CI8EjiMjhPnrbeq2htd4RsqjDI7enK0l4HAvy-kZJcPNXY6JRgq2R0C_Qh1gSSu8nd_RuutKDmEQ-r_uf6j5KsF-jTRs8qRgPEeO3DLgtDjSl2TLTWXEA8kaSy6Gj41rCyHO5pwPCdK2ySqe1oKIltCwLDAk4MfA83-yPVmeS3B6LZl79yCvpTczE\",\n        // },\n        transports: ['websocket'],\n        upgrade: true,\n        withCredentials: true,\n        auth: headers\n      });\n      const ws = new WebSocketConnection(socket, acknowledgement);\n      this.socket = ws;\n      return ws;\n    });\n    this.url = opts.url;\n    this.accessToken = opts.accessToken;\n  }\n}","map":{"version":3,"names":["connect","WebSocketConnection","BaseWebSocketService","SignerWebSocketService","constructor","opts","_defineProperty","socket","disconnect","acknowledgement","headers","getHeaders","accessToken","url","autoConnect","reconnection","transports","upgrade","withCredentials","auth","ws"],"sources":["/Users/phuocnd/phuocnd/works/mirai/miraiidjs/src/sign-provider/transports/websocket/ws-signer.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\nimport { connect, io } from 'socket.io-client';\nimport { WebSocketConnection } from './connection-wrapper';\nimport { BaseWebSocketService, IWSOpts } from './ws-base';\n\nexport class SignerWebSocketService extends BaseWebSocketService {\n\tprivate url: string;\n\tprivate accessToken: string;\n\n\tpublic socket: WebSocketConnection;\n\n\tconstructor(opts: IWSOpts) {\n\t\tsuper(opts);\n\n\t\tthis.url = opts.url;\n\t\tthis.accessToken = opts.accessToken;\n\t}\n\n\tpublic disconnect = async () => {\n\t\treturn this.socket.disconnect();\n\t};\n\n\tpublic establish = async (acknowledgement?: boolean): Promise<WebSocketConnection> => {\n\t\tconst headers = await this.getHeaders(this.accessToken);\n\n\t\t// const socket = io(this.url, {\n\t\t// \tautoConnect: false,\n\t\t// \treconnection: true,\n\t\t// \ttransportOptions: {\n\t\t// \t\twebsocket: {\n\t\t// \t\t\textraHeaders: headers,\n\t\t// \t\t},\n\t\t// \t},\n\t\t// \textraHeaders: headers,\n\t\t// \ttransports: ['websocket'],\n\t\t// \tauth: headers,\n\t\t// });\n\n\t\tconst socket = connect(this.url, {\n\t\t\tautoConnect: false,\n\t\t\treconnection: false,\n\t\t\t// transportOptions: {\n\t\t\t//   websocket: {\n\t\t\t//     extraHeaders: {\n\t\t\t//       authorization:\n\t\t\t//         \"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJhMGJhYzYwNC0wZmE0LTQ0N2EtYTNkZS00ZGVmZjAyMDA4YzQiLCJqdGkiOiIyYzQyZmQzZC04M2FkLTQzZTEtOWE4NS00NjRlZjRlNzhkYjkiLCJleHAiOjE2OTI5NDYxNTcsInN1YiI6ImJmYjRmZmY2LWUzMTQtNDI2OS1iYTAyLWRmYzU5MTk1MzRjZiIsInNjb3BlcyI6WyJvcGVuaWQiLCJlbWFpbCIsIm9mZmxpbmVfYWNjZXNzIiwicHJvZmlsZSJdLCJlbWFpbCI6ImR1Y3BodW9jLnQ5QGdtYWlsLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJuYW1lIjoiUGjGsOG7m2MgTmd1eeG7hW4gxJDhu6ljIiwiZ2l2ZW5fbmFtZSI6IlBoxrDhu5tjIiwiZmFtaWx5X25hbWUiOiJOZ3V54buFbiDEkOG7qWMiLCJpc3MiOiJodHRwczovL2lkLWRldi12Mi5taXJhaWxhYnMuY28iLCJhenAiOiJhMGJhYzYwNC0wZmE0LTQ0N2EtYTNkZS00ZGVmZjAyMDA4YzQiLCJpYXQiOjE2OTI4NTk3NTd9.CoeBHfbUk3hC9PGz4c51dOojXptKR78OsfcSEoQY6PVulcEE8tjxDEOqMtlDU6-eyKDTg9qiQRNxtXf5iHVFeNbZ9E32JdyFsDiwSGjaD1HRpzq7Xm8QkA9SPFO0QQP6BSNgHIgg4fYNrii0t-0r7wojg_sfgjDDyCX_vmZY4TYCIjr9TS9vrELupcW716Y_seiGr6WQfy6HyfTbVSGRb4yviNcOMjDeORht2JuJajLsrMSQsYGXcx_V04uXrcC1SY0xi7LnsVQfQSWyKTf6xoTix6cm3gnzbyZYZJrPqDJtDu2FRxBLNLR53NNc8v3UjaJREjdcNgvvLGarw_HY61Azsqh5LaE_KZuZeBxtBBVjlN209N7hRNPrKv_RbnTnIBvoGjv0zjlN4r42_DPGWojnaqkuConrY2W7daQHHPMdf7XnnlfPL7g3osyO_8TMFLVjdxBEr1cPe6YZERvMMiVbDYg3fEps4dsjabJE4CkaTDt5j1CI8EjiMjhPnrbeq2htd4RsqjDI7enK0l4HAvy-kZJcPNXY6JRgq2R0C_Qh1gSSu8nd_RuutKDmEQ-r_uf6j5KsF-jTRs8qRgPEeO3DLgtDjSl2TLTWXEA8kaSy6Gj41rCyHO5pwPCdK2ySqe1oKIltCwLDAk4MfA83-yPVmeS3B6LZl79yCvpTczE\",\n\t\t\t//     },\n\t\t\t//   },\n\t\t\t// },\n\t\t\t// extraHeaders: {\n\t\t\t//   authorization:\n\t\t\t//     \"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJhMGJhYzYwNC0wZmE0LTQ0N2EtYTNkZS00ZGVmZjAyMDA4YzQiLCJqdGkiOiIyYzQyZmQzZC04M2FkLTQzZTEtOWE4NS00NjRlZjRlNzhkYjkiLCJleHAiOjE2OTI5NDYxNTcsInN1YiI6ImJmYjRmZmY2LWUzMTQtNDI2OS1iYTAyLWRmYzU5MTk1MzRjZiIsInNjb3BlcyI6WyJvcGVuaWQiLCJlbWFpbCIsIm9mZmxpbmVfYWNjZXNzIiwicHJvZmlsZSJdLCJlbWFpbCI6ImR1Y3BodW9jLnQ5QGdtYWlsLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJuYW1lIjoiUGjGsOG7m2MgTmd1eeG7hW4gxJDhu6ljIiwiZ2l2ZW5fbmFtZSI6IlBoxrDhu5tjIiwiZmFtaWx5X25hbWUiOiJOZ3V54buFbiDEkOG7qWMiLCJpc3MiOiJodHRwczovL2lkLWRldi12Mi5taXJhaWxhYnMuY28iLCJhenAiOiJhMGJhYzYwNC0wZmE0LTQ0N2EtYTNkZS00ZGVmZjAyMDA4YzQiLCJpYXQiOjE2OTI4NTk3NTd9.CoeBHfbUk3hC9PGz4c51dOojXptKR78OsfcSEoQY6PVulcEE8tjxDEOqMtlDU6-eyKDTg9qiQRNxtXf5iHVFeNbZ9E32JdyFsDiwSGjaD1HRpzq7Xm8QkA9SPFO0QQP6BSNgHIgg4fYNrii0t-0r7wojg_sfgjDDyCX_vmZY4TYCIjr9TS9vrELupcW716Y_seiGr6WQfy6HyfTbVSGRb4yviNcOMjDeORht2JuJajLsrMSQsYGXcx_V04uXrcC1SY0xi7LnsVQfQSWyKTf6xoTix6cm3gnzbyZYZJrPqDJtDu2FRxBLNLR53NNc8v3UjaJREjdcNgvvLGarw_HY61Azsqh5LaE_KZuZeBxtBBVjlN209N7hRNPrKv_RbnTnIBvoGjv0zjlN4r42_DPGWojnaqkuConrY2W7daQHHPMdf7XnnlfPL7g3osyO_8TMFLVjdxBEr1cPe6YZERvMMiVbDYg3fEps4dsjabJE4CkaTDt5j1CI8EjiMjhPnrbeq2htd4RsqjDI7enK0l4HAvy-kZJcPNXY6JRgq2R0C_Qh1gSSu8nd_RuutKDmEQ-r_uf6j5KsF-jTRs8qRgPEeO3DLgtDjSl2TLTWXEA8kaSy6Gj41rCyHO5pwPCdK2ySqe1oKIltCwLDAk4MfA83-yPVmeS3B6LZl79yCvpTczE\",\n\t\t\t// },\n\t\t\ttransports: ['websocket'],\n\t\t\tupgrade: true,\n\t\t\twithCredentials: true,\n\t\t\tauth: headers,\n\t\t});\n\n\t\tconst ws = new WebSocketConnection(socket, acknowledgement);\n\n\t\tthis.socket = ws;\n\n\t\treturn ws;\n\t};\n}\n"],"mappings":";AAAA;AACA,SAASA,OAAO,QAAY,kBAAkB;AAC9C,SAASC,mBAAmB,QAAQ,sBAAsB;AAC1D,SAASC,oBAAoB,QAAiB,WAAW;AAEzD,OAAO,MAAMC,sBAAsB,SAASD,oBAAoB,CAAC;EAMhEE,WAAWA,CAACC,IAAa,EAAE;IAC1B,KAAK,CAACA,IAAI,CAAC;IAACC,eAAA;IAAAA,eAAA;IAAAA,eAAA;IAAAA,eAAA,qBAMO,YAAY;MAC/B,OAAO,IAAI,CAACC,MAAM,CAACC,UAAU,CAAC,CAAC;IAChC,CAAC;IAAAF,eAAA,oBAEkB,MAAOG,eAAyB,IAAmC;MACrF,MAAMC,OAAO,GAAG,MAAM,IAAI,CAACC,UAAU,CAAC,IAAI,CAACC,WAAW,CAAC;;MAEvD;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;;MAEA,MAAML,MAAM,GAAGP,OAAO,CAAC,IAAI,CAACa,GAAG,EAAE;QAChCC,WAAW,EAAE,KAAK;QAClBC,YAAY,EAAE,KAAK;QACnB;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACAC,UAAU,EAAE,CAAC,WAAW,CAAC;QACzBC,OAAO,EAAE,IAAI;QACbC,eAAe,EAAE,IAAI;QACrBC,IAAI,EAAET;MACP,CAAC,CAAC;MAEF,MAAMU,EAAE,GAAG,IAAInB,mBAAmB,CAACM,MAAM,EAAEE,eAAe,CAAC;MAE3D,IAAI,CAACF,MAAM,GAAGa,EAAE;MAEhB,OAAOA,EAAE;IACV,CAAC;IAlDA,IAAI,CAACP,GAAG,GAAGR,IAAI,CAACQ,GAAG;IACnB,IAAI,CAACD,WAAW,GAAGP,IAAI,CAACO,WAAW;EACpC;AAiDD"},"metadata":{},"sourceType":"module","externalDependencies":[]}