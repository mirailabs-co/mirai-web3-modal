{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport axios from 'axios';\nimport { MiraiConnection } from '../connection/mirai-connection';\nimport { Core } from './core';\nimport { ServiceQueryRequest } from '../../shared/service-query-request';\nconst PAIRING_URL = 'http://localhost:3000/get-pairing';\nexport class MiraiCore extends Core {\n  constructor(opts) {\n    super(opts);\n    _defineProperty(this, \"chains\", void 0);\n    _defineProperty(this, \"namespace\", void 0);\n    _defineProperty(this, \"connection\", void 0);\n    _defineProperty(this, \"onOpenConnection\", void 0);\n    this.chains = opts.chains;\n    this.namespace = opts.chainNameSpace;\n    this.onOpenConnection = opts.onOpenConnection;\n  }\n  static async init(opts) {\n    const core = new MiraiCore(opts);\n    await core.initialize();\n    return core;\n  }\n  async connect(_ref) {\n    let {\n      accessToken\n    } = _ref;\n    await this.connection.connect({\n      accessToken\n    });\n    return this.connection;\n  }\n  async showConnectionModal(connection) {\n    const topicId = connection.topicId;\n    console.log('topicId', topicId);\n\n    // We're get pairing uri\n    const {\n      data\n    } = await axios.get(\"\".concat(PAIRING_URL, \"?topicId=\").concat(topicId));\n    console.log('Get Pairing URI', data);\n    const url = new URL('http://id-web-local.mirailabs.co/sign?a=1');\n    const __serviceQuery = new ServiceQueryRequest(url.href, url.searchParams.toString());\n    __serviceQuery.addParam('topicId', topicId);\n    __serviceQuery.addParam('wc_uri', data);\n    if (data) {\n      typeof this.onOpenConnection === 'function' && (await this.onOpenConnection(__serviceQuery.toUri()));\n    }\n  }\n  disconect(connection) {\n    throw new Error('Method not implemented.');\n  }\n  disconectAll() {\n    throw new Error('Method not implemented.');\n  }\n\n  // PRIVATE\n  async initialize() {\n    try {\n      this.connection = await MiraiConnection.init();\n      this.connection.emit('chains', this.chains);\n      this.connection.emit('namespace', this.namespace);\n    } catch (e) {\n      console.error(e);\n    }\n  }\n}","map":{"version":3,"names":["axios","MiraiConnection","Core","ServiceQueryRequest","PAIRING_URL","MiraiCore","constructor","opts","_defineProperty","chains","namespace","chainNameSpace","onOpenConnection","init","core","initialize","connect","_ref","accessToken","connection","showConnectionModal","topicId","console","log","data","get","concat","url","URL","__serviceQuery","href","searchParams","toString","addParam","toUri","disconect","Error","disconectAll","emit","e","error"],"sources":["/Users/phuocnd/phuocnd/works/mirai/miraiidjs/src/sign-provider/cores/mirai-core.ts"],"sourcesContent":["import axios from 'axios';\nimport { MiraiConnection } from '../connection/mirai-connection';\nimport { Core, ICore } from './core';\nimport { Connection } from '../connection/connection';\nimport { Chain } from '../../constants/chains';\nimport { ServiceQueryRequest } from '../../shared/service-query-request';\n\nconst PAIRING_URL: string = 'http://localhost:3000/get-pairing';\n\nexport class MiraiCore extends Core {\n\tchains: Chain[];\n\tnamespace: string;\n\tconnection: MiraiConnection;\n\n\tonOpenConnection: (url: string) => Promise<void>;\n\n\tconstructor(opts?: ICore) {\n\t\tsuper(opts);\n\n\t\tthis.chains = opts.chains;\n\t\tthis.namespace = opts.chainNameSpace;\n\t\tthis.onOpenConnection = opts.onOpenConnection;\n\t}\n\n\tstatic async init(opts?: ICore) {\n\t\tconst core = new MiraiCore(opts);\n\t\tawait core.initialize();\n\n\t\treturn core;\n\t}\n\n\tpublic async connect({ accessToken }: { accessToken: string }) {\n\t\tawait this.connection.connect({ accessToken });\n\n\t\treturn this.connection;\n\t}\n\n\tpublic async showConnectionModal(connection: MiraiConnection) {\n\t\tconst topicId = connection.topicId;\n\n\t\tconsole.log('topicId', topicId);\n\n\t\t// We're get pairing uri\n\t\tconst { data } = await axios.get(`${PAIRING_URL}?topicId=${topicId}`);\n\n\t\tconsole.log('Get Pairing URI', data);\n\n\t\tconst url = new URL('http://id-web-local.mirailabs.co/sign?a=1');\n\t\tconst __serviceQuery = new ServiceQueryRequest(url.href, url.searchParams.toString());\n\n\t\t__serviceQuery.addParam('topicId', topicId);\n\t\t__serviceQuery.addParam('wc_uri', data);\n\n\t\tif (data) {\n\t\t\ttypeof this.onOpenConnection === 'function' && (await this.onOpenConnection(__serviceQuery.toUri()));\n\t\t}\n\t}\n\n\tpublic disconect(connection: Connection): Promise<void> {\n\t\tthrow new Error('Method not implemented.');\n\t}\n\n\tpublic disconectAll(): Promise<void> {\n\t\tthrow new Error('Method not implemented.');\n\t}\n\n\t// PRIVATE\n\tasync initialize() {\n\t\ttry {\n\t\t\tthis.connection = await MiraiConnection.init();\n\n\t\t\tthis.connection.emit('chains', this.chains);\n\t\t\tthis.connection.emit('namespace', this.namespace);\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t}\n\t}\n}\n"],"mappings":";AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,eAAe,QAAQ,gCAAgC;AAChE,SAASC,IAAI,QAAe,QAAQ;AAGpC,SAASC,mBAAmB,QAAQ,oCAAoC;AAExE,MAAMC,WAAmB,GAAG,mCAAmC;AAE/D,OAAO,MAAMC,SAAS,SAASH,IAAI,CAAC;EAOnCI,WAAWA,CAACC,IAAY,EAAE;IACzB,KAAK,CAACA,IAAI,CAAC;IAACC,eAAA;IAAAA,eAAA;IAAAA,eAAA;IAAAA,eAAA;IAEZ,IAAI,CAACC,MAAM,GAAGF,IAAI,CAACE,MAAM;IACzB,IAAI,CAACC,SAAS,GAAGH,IAAI,CAACI,cAAc;IACpC,IAAI,CAACC,gBAAgB,GAAGL,IAAI,CAACK,gBAAgB;EAC9C;EAEA,aAAaC,IAAIA,CAACN,IAAY,EAAE;IAC/B,MAAMO,IAAI,GAAG,IAAIT,SAAS,CAACE,IAAI,CAAC;IAChC,MAAMO,IAAI,CAACC,UAAU,CAAC,CAAC;IAEvB,OAAOD,IAAI;EACZ;EAEA,MAAaE,OAAOA,CAAAC,IAAA,EAA2C;IAAA,IAA1C;MAAEC;IAAqC,CAAC,GAAAD,IAAA;IAC5D,MAAM,IAAI,CAACE,UAAU,CAACH,OAAO,CAAC;MAAEE;IAAY,CAAC,CAAC;IAE9C,OAAO,IAAI,CAACC,UAAU;EACvB;EAEA,MAAaC,mBAAmBA,CAACD,UAA2B,EAAE;IAC7D,MAAME,OAAO,GAAGF,UAAU,CAACE,OAAO;IAElCC,OAAO,CAACC,GAAG,CAAC,SAAS,EAAEF,OAAO,CAAC;;IAE/B;IACA,MAAM;MAAEG;IAAK,CAAC,GAAG,MAAMxB,KAAK,CAACyB,GAAG,IAAAC,MAAA,CAAItB,WAAW,eAAAsB,MAAA,CAAYL,OAAO,CAAE,CAAC;IAErEC,OAAO,CAACC,GAAG,CAAC,iBAAiB,EAAEC,IAAI,CAAC;IAEpC,MAAMG,GAAG,GAAG,IAAIC,GAAG,CAAC,2CAA2C,CAAC;IAChE,MAAMC,cAAc,GAAG,IAAI1B,mBAAmB,CAACwB,GAAG,CAACG,IAAI,EAAEH,GAAG,CAACI,YAAY,CAACC,QAAQ,CAAC,CAAC,CAAC;IAErFH,cAAc,CAACI,QAAQ,CAAC,SAAS,EAAEZ,OAAO,CAAC;IAC3CQ,cAAc,CAACI,QAAQ,CAAC,QAAQ,EAAET,IAAI,CAAC;IAEvC,IAAIA,IAAI,EAAE;MACT,OAAO,IAAI,CAACZ,gBAAgB,KAAK,UAAU,KAAK,MAAM,IAAI,CAACA,gBAAgB,CAACiB,cAAc,CAACK,KAAK,CAAC,CAAC,CAAC,CAAC;IACrG;EACD;EAEOC,SAASA,CAAChB,UAAsB,EAAiB;IACvD,MAAM,IAAIiB,KAAK,CAAC,yBAAyB,CAAC;EAC3C;EAEOC,YAAYA,CAAA,EAAkB;IACpC,MAAM,IAAID,KAAK,CAAC,yBAAyB,CAAC;EAC3C;;EAEA;EACA,MAAMrB,UAAUA,CAAA,EAAG;IAClB,IAAI;MACH,IAAI,CAACI,UAAU,GAAG,MAAMlB,eAAe,CAACY,IAAI,CAAC,CAAC;MAE9C,IAAI,CAACM,UAAU,CAACmB,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC7B,MAAM,CAAC;MAC3C,IAAI,CAACU,UAAU,CAACmB,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC5B,SAAS,CAAC;IAClD,CAAC,CAAC,OAAO6B,CAAC,EAAE;MACXjB,OAAO,CAACkB,KAAK,CAACD,CAAC,CAAC;IACjB;EACD;AACD"},"metadata":{},"sourceType":"module","externalDependencies":[]}